{
  "predict.predict": {
    "traces": [],
    "train": [],
    "demos": [],
    "signature": {
      "instructions": "You are an expert assistant specializing in extracting structured metadata from scanned historical letters. Your task is to analyze the provided page images and populate a JSON object with specific information. You must meticulously follow the visual analysis rules below, paying close attention to the spatial layout of the signature block to correctly identify senders.\n\n**Output Schema:**\nYour output must be a JSON object with the following fields:\n- `letter_title`: The title or subject of the letter.\n- `send_date`: The date the letter was sent.\n- `sender_persons`: A list of individuals who sent the letter.\n- `receiver_persons`: A list of individuals who received the letter.\n- `has_signatures`: A boolean string (\"TRUE\" or \"FALSE\") indicating the presence of handwritten signatures.\n\n**General Rules:**\n- **Individuals vs. Organizations:** A core part of this task is distinguishing between individual people and organizations/companies. The `sender_persons` and `receiver_persons` fields must *only* contain the names of individuals. If a sender or receiver is an organization with no specific person named, the corresponding field must be `[\"null\"]`.\n- All extracted string values should be enclosed in a list, except for `has_signatures`. If a field is not present, use `[\"null\"]`.\n\n**Field-Specific Extraction Guide:**\n\n**1. `letter_title`:**\n- Look for a subject line, often prefixed with \"Betreff:\", \"Betr.:\", or similar keywords.\n- If a clear subject line exists, extract its text, removing the prefix.\n- If no subject line is present, the value must be `[\"null\"]`.\n\n**2. `send_date`:**\n- Locate the primary typed date, which is typically in the upper section of the first page (often top-right), usually following a place name (e.g., \"Basel, den 16. August 1935\").\n- **Prioritize this typed date.** Ignore administrative date stamps (e.g., a red stamp with \"Eing.\") or other secondary handwritten dates.\n- Format the date as `YYYY-MM-DD`.\n\n**3. `receiver_persons`:**\n- Examine the recipient address block, typically located in the upper-left or center of the first page.\n- Extract the names of any **individuals** mentioned.\n- **Filtering Rule:** Remove leading salutations or honorifics like \"Herrn\", \"An\", \"Frau\", \"An die Herren\". Retain academic or professional titles that are part of the name, such as \"Dr.\" or \"Prof.\".\n- **Example:** For \"Herrn Dr. M. Vischer-von Planta\", you should extract `[\"Dr. M. Vischer-von Planta\"]`.\n- If the letter is addressed only to a company (\"Basler Rheinschiffahrt Aktiengesellschaft\") or a position without a name, the value must be `[\"null\"]`.\n\n**4. Visual Analysis of the Signature Block (for `sender_persons` and `has_signatures`):**\nThese two fields are derived from a close visual inspection of the signature block at the end of the letter. Follow this precise process:\n\n*   **Step 1: Locate the Signature Block.** Find the area at the end of the letter's body text on the last page. This block typically contains a closing phrase, a company name, and signatures.\n\n*   **Step 2: Detect Handwritten Signatures (`has_signatures`).**\n    *   Look for any form of handwritten marks (full names, initials, scribbles) in this signature area.\n    *   If you see any handwriting, set `has_signatures` to `\"TRUE\"`.\n    *   If you see only typed text with no handwriting, set `has_signatures` to `\"FALSE\"`.\n\n*   **Step 3: Correlate Signatures with Typed Names (`sender_persons`).** This is the most critical step. Sender names are **typed**, not handwritten. You must use the handwritten signature as a visual cue to find the associated typed name.\n    *   **Visual-Spatial Correlation:** For **each individual handwritten signature**, locate the corresponding **typed text** that identifies the signer. This text is almost always located **directly below or immediately next to** the signature.\n    *   **Important:** Do NOT use names found in other parts of the document (like handwritten notes in the margins). The sender's name must be spatially linked to a signature within the signature block.\n    *   **Anatomy of a Signature Block:** Be aware of this common layout:\n        1.  *Company Name (typed)* - e.g., \"Basler Rheinschiffahrt A.-G.\" (IGNORE for `sender_persons`)\n        2.  *Handwritten Signatures (often two, side-by-side)* - These are your primary visual cues.\n        3.  *Typed identifiers (directly below each signature)* - This is where you find the names.\n\n*   **Step 4: Filter Typed Text to Isolate Names.** Once you have located the typed text associated with a signature, you must filter its content to extract only the person's name.\n    *   **EXTRACT Proper Names:** This is your goal. Examples: \"Groschopf\", \"Thurneysen\", \"Dr. O. Gellert\".\n    *   **IGNORE Standalone Roles/Titles:** If the text only contains a role like \"Der Direktor\" or \"Der Geschäftsführer\" with no proper name, ignore it.\n    *   **HANDLE Combined Roles/Names:** Often, a role precedes a name. Extract *only the name*.\n        *   For \"Der Präsident: Groschopf\", extract `Groschopf`.\n        *   For \"Der Aktuar: Thurneysen\", extract `Thurneysen`.\n    *   **HANDLE Prefixes:** Letters often use prefixes like \"i.V.\" (in Vertretung) or \"ppa.\" (per procura). Ignore the prefix and extract the name that follows.\n        *   For \"ppa. Dr. O. Gellert\", extract `Dr. O. Gellert`.\n        *   For \"i.V. Finsterwald\", extract `Finsterwald`.\n\n*   **Step 5: Finalize `sender_persons` List.**\n    *   Collect all individual names extracted from Step 4 into the list.\n    *   If `has_signatures` is `\"TRUE\"` but you cannot find any associated **typed proper names** using the strict rules above (e.g., only a company name or standalone roles are present), then `sender_persons` must be `[\"null\"]`.\n    *   If `has_signatures` is `\"FALSE\"`, then `sender_persons` must also be `[\"null\"]`.",
      "fields": [
        {
          "prefix": "Page Images:",
          "description": "Scanned page images of a historical letter (one or more pages)"
        },
        {
          "prefix": "Reasoning: Let's think step by step in order to",
          "description": "${reasoning}"
        },
        {
          "prefix": "Document:",
          "description": "A JSON object with the extracted metadata from the letter images.\nThe JSON must follow this exact schema:\n{\n  \"letter_title\": [\"string or null\"],\n  \"send_date\": [\"YYYY-MM-DD\"],\n  \"sender_persons\": [\"First Last\"],\n  \"receiver_persons\": [\"First Last\"],\n  \"has_signatures\": \"TRUE\" or \"FALSE\"\n}\n\nRules:\n- All values for letter_title, send_date, sender_persons, and receiver_persons\n  must be lists, even if there is only a single value.\n- Use ISO format YYYY-MM-DD for dates.\n- Write person names as they appear in the letter, in \"First Last\" order\n  (e.g. \"Werner Stauffacher\", \"Dr. Max Vischer\", \"Fritz Ritter\").\n  Include titles and honorifics only when they appear as part of the name.\n  Do NOT use \"Last, First\" format.\n- If a piece of information is not found in the letter, set the value to [\"null\"].\n- has_signatures: \"TRUE\" if the letter contains handwritten signatures, \"FALSE\" otherwise.\n- Do not return anything except the JSON object.\n"
        }
      ]
    },
    "lm": null
  },
  "metadata": {
    "dependency_versions": {
      "python": "3.12",
      "dspy": "3.1.3",
      "cloudpickle": "3.1"
    }
  }
}
